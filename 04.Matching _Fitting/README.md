# Fitting and Matching

## Fitting
주어진 데이터를 가장 잘 설명할 수 있는 수학적 모델을 찾는 과정. 쉽게 말해, 우리가 어떤 데이터 포인트들을 가지고 있을 때, 그 데이터들이 어떤 패턴을 따르고 있는지 알아내기 위해 적합한 수학적 함수(모델)를 찾는 것을 의미한다.
- 예를 들어, 2차원 평면에 여러 개의 점이 주어졌을 때, 이 점들을 가장 잘 설명하는 직선이나 곡선을 찾는 과정이 피팅.
- 이를 통해 주어진 데이터에서 중요한 경향을 분석하거나, 미래의 데이터 값을 예측하는 데 사용될 수 있음.

피팅을 수행하는 방법으로는 여러 가지가 있으며, 그 중 가장 기본적인 방법이 **Least Squares (최소 제곱법)**이다. 이 방법은 데이터 포인트와 모델 사이의 차이를 최소화하는 방식으로 작동한다.

### Why we need Fitting?
- 로컬 이미지 특징이 완벽하지 않기 때문에 피팅 과정이 필요.
- 피팅 과정은 주어진 데이터에 가장 잘 맞는 수학적 모델을 선택하는 과정.

### Fitting Problems
- 노이즈가 많은 데이터.
- 외곽치 (Outliers).
- 데이터의 결손.

### Fitting Technique:
1. Least Square Methods
2. RANSAC
3. Hough Transform

---

## Technique Detail

### (1) Least Square
주어진 데이터를 기반으로 가장 잘 맞는 수학적 모델을 찾기 위해 오차의 제곱합을 최소화하는 피팅 기법.

#### i. Linear Least Square
- 설명: Linear Least Square는 주어진 데이터 포인트들이 선형 모델 \( y = ax + b \)에 가장 잘 맞도록 \( a \)와 \( b \)를 추정하는 기법.
- 목표: 모델과 데이터 간의 오차 제곱합을 최소화하여 최적의 직선을 찾는 것.
- 사용법: 행렬 연산을 통해 X(입력 데이터)와 y(출력)의 관계를 분석하고, 미분을 통해 최소 오차를 만족하는 파라미터를 계산.
- 적용 예시: 간단한 선형 회귀 문제에서 데이터와 직선을 맞추기 위해 사용.

#### ii. Ordinary Linear Least Square
- 설명: 가장 기본적인 형태의 Least Square 기법으로, 데이터와 모델 간의 수직 거리를 최소화하는 방식으로 모델을 피팅. 수직거리란 모든 데이터 포인트에서 모델(데이터 설명 위한 수학적 표현)로의 수직 거리, 즉 잔차를 뜻한다.
- 목표: 오차 함수를 최소화하는 \( a \)와 \( b \)를 찾는 것. 여기서 오차 함수는 각 데이터 포인트 \( (x_i, y_i) \)에서 직선 모델 \( y = ax + b \)와의 차이(잔차)의 제곱을 모두 더한 값을 최소화함을 뜻한다.
- 해결 방법: 미분을 통해 최적의 조건을 찾아 계산.
- 한계점: 외곽치에 민감하며, 수평선이나 수직선을 표현하는 데 문제가 있음.

#### iii. Total Linear Least Square
- 설명: 데이터 포인트들과 모델 간의 수직 거리뿐만 아니라 모든 방향에서의 오차를 최소화하는 방법, 데이터를 회전시켜도 동일한 결과를 얻을 수 있어 회전 불변성을 가짐.
- 목표: \( ax + by + c = 0 \) 형태로 모든 점들이 이 선형 모델에 가장 잘 맞도록 하는 것.
- 해결 방법: 고유값 분해를 이용해, 최적의 해는 가장 작은 고유값에 대응하는 고유벡터로부터 결정.
- 장점: 노이즈에 강건하며, 회전 불변성을 가지므로 더욱 일반적인 상황에서도 사용이 가능.

#### iv. Least Squares와 외곽치(일반적인 데이터를 벗어난 데이터)
- 설명: Least Square는 외곽치(outliers)에 매우 민감하여 전체 모델 피팅 결과가 크게 왜곡될 수 있다.

---

### (2) RANSAC
RANSAC은 많은 외곽치(outliers)가 포함된 데이터에서 강건하게 모델을 피팅하기 위한 알고리즘으로 이 알고리즘은 반복적인 가설 설정과 검증을 통해 최적의 모델을 찾는다.
- 특징:
  1. 외곽치 처리 능력: 많은 외곽치가 있는 데이터에서 효과적.
  2. 모델 추정 시간 감소: 반복적으로 모델을 가설 설정하고 검증하므로 빠르게 적합한 모델 찾는다.
  3. 반복적: 가설 설정과 테스트 반복.
  4. 투표 방식: 최적의 모델을 선정하는 투표방식으로 외곽치가 아닌, 즉 모델과 거리가 미리 설정된 임계값 \( t \) 이하인 포인트들(inlier)들이 많을수록 투표 많이 받는 것.

- 작동 과정:
  1. 데이터에서 임의로 작은 샘플 선택.
  2. 선택된 포인트들로 모델 가설화.
  3. 가설 모델과 데이터 포인트 간의 오차 계산.
  4. 모델과 일치하는 포인트 찾고 나머지 외곽치로 간주.
  5. 이 과정을 여러 번 반복하여 가장 좋은 모델 선택.

- RANSAC 파라미터:
  - 가설을 세우기 위한 데이터 포인트 수 \( s \).
  - 반복 횟수 \( N \).
  - 거리 임계값 \( t \).
  - 모델을 수용하기 위해 필요한 인라이어의 수 \( d \).

- 장점:
  1. 간단함.
  2. 다양한 문제에 적용 가능.
  3. 실제로 잘 작동.

- 단점:
  1. 조정할 파라미터가 많음.
  2. 외곽치가 아닌 비율이 낮을 때 잘 작동하지 않음(반복이 너무 많이 되어야 하거나 완전 실패).
  3. 최소 샘플 수 기반으로 모델의 초기화가 항상 잘 수행되는 것은 아님.
  4. 전역 최적 해를 보장하지 않음.

---

### (3) Hough Transform
- **설명**: Hough Transform은 이미지에서 직선, 곡선 또는 기타 형태를 검출하는 데 사용되는 기법. 주로 알려진 형태의 객체를 검출하기 위해 이미지 공간의 문제를 파라미터 공간으로 변환하여 해결.

#### Hough Transform - 선 검출
1. 주어진 조건: 이미지에서 검출된 엣지 포인트 \( (x_i, y_i) \).
2. 목표: 직선 방정식 \( y = mx + c \)에 해당하는 선을 검출하는 것.
3. 변환 과정: 이미지 공간의 각 엣지 포인트는 파라미터 공간 \( (m, c) \)에서 직선으로 변환.
4. 투표 방식: 각 포인트는 파라미터 공간에서 자신을 지나는 모든 가능한 직선에 투표하며, 가장 많은 투표를 받은 직선이 이미지에서 검출된 선에 해당.

#### Hough Transform - 선 검출 알고리즘
1. 파라미터 공간 양자화: \( (m, c) \) 공간을 특정 간격으로 나눔.
2. 축적 배열 생성: 투표를 위한 배열을 초기화.
3. 초기화: 모든 \( (m, c) \) 쌍의 값을 0으로 설정.
4. 투표 과정: 각 엣지 포인트에 대해 가능한 모든 직선에 대해 투표.
5. 국소 최대값 찾기: 가장 많은 투표를 받은 지점이 실제 이미지에서의 선을 나타냄.

#### Hough Transform - 선 검출 장점
1. 불완전하거나 노이즈가 많은 데이터에도 잘 작동.
2. 여러 개의 동일한 형태를 동시에 검출할 수 있음.
3. 노이즈에 강하여, 노이즈 포인트는 일반적으로 충분한 투표를 얻지 못해 검출되지 않음.

#### Hough Transform - 선 검출 도전과제
1. 파라미터 수가 많아지면 복잡도가 급격히 증가하여 고차원 문제에 비효율적.
2. 파라미터 공간의 양자화와 빈 크기를 신중하게 조정해야 민감도와 노이즈 강건성의 균형을 맞출 수 있음.

#### Better Parameterization
1. \( (a, b) \) 공간의 문제: 수직선과 무한한 파라미터로 인해 계산이 복잡해질 수 있음.
2. 극좌표 표현 (Polar Representation): 극좌표 \( (\theta, \rho) \)를 사용하여 선을 표현하면 파라미터 범위가 유한하게 되어 효율적.

---

## Fitting and Matching 정리

### Image Stitching
- 여러 이미지를 하나의 큰 이미지로 연결하는 기술로, 주로 파노라마 이미지 생성에 사용.

### Feature Matching by Appearance
- **Feature Detection**: 이미지 내에서 중요한 요소(엣지, 코너, 블롭 등)를 탐지하는 과정.
- **Feature Descriptors**: 탐지된 특징을 표현하기 위한 기술로, SIFT, SURF, GLOH 등 다양한 기술이 사용.
- **거리 계산**: 두 특징점 간의 유사도를 측정하기 위해 다양한 거리 측정 기법(SSD, 코사인 거리, Bhattacharyya 거리 등)이 사용.

### Fitting Helps Matching
- 두 이미지 간의 특징점을 이용해 이미지 1의 특징을 이미지 2로 매핑하는 호모그래피 \( H \)를 피팅하는 과정.
- **호모그래피 (Homography)**: 두 이미지 간의 대응 관계를 수학적으로 표현하는 변환으로, 주로 하나의 이미지에서 다른 이미지로 특정 평면의 모습을 맞추어 변형할 때 사용.
  1. 평면 투영 변환: 호모그래피는 한 평면에서 다른 평면으로의 투영을 정의.
  2. 3x3 행렬: 이 변환은 3x3 행렬로 표현되어, 이 행렬을 통해 한 이미지의 점을 다른 이미지의 점으로 변환할 수 있음.

---

### 결론
- 선에 속하는 점을 알 때 최적의 선 파라미터를 찾는 방법?: Least Squares 사용.
- 외곽치가 있을 경우 어떻게 해야 하는가?: RANSAC 사용.
- 다수의 선이 있을 경우?: RANSAC과 Hough Transform 같은 투표 방법 사용.
- Fitting이 Matching을 돕는다: 피팅을 통해 매칭 과정이 더욱 정밀해질 수 있음.
